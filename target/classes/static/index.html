<!DOCTYPE html>
<html lang="zh">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>localhost</title>

	<link href="http://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
	<link href="http://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

	<link rel="stylesheet" type="text/css" href="css/demo-index.css">
	<link rel="stylesheet" href="assets/css/jquery.mCustomScrollbar.min.css" />
	<link rel="stylesheet" href="assets/css/custom.css">
	<script src="js/jquery.js" type="text/javascript"></script>


</head>
<body>
<script>

    /**
     * 关闭标签页
     * @param button
     */
    function closeTab (button) {

        //通过该button找到对应li标签的id
        var li_id = $(button).parent().parent().attr('id');
        var id = li_id.replace("tab_li_","");

        //如果关闭的是当前激活的TAB，激活他的前一个TAB
        if ($("li.active").attr('id') == li_id) {
            $("li.active").prev().find("a").click();
        }

        //关闭TAB
        $("#" + li_id).remove();
        $("#tab_content_" + id).remove();
    };

    /**
     * 判断是否存在指定的标签页
     * @param tabMainName
     * @param tabName
     * @returns {Boolean}
     */
    function checkTabIsExists(tabMainName, tabName){
        var tab = $("#"+tabMainName+" > #tab_li_"+tabName);
        //console.log(tab.length)
        return tab.length > 0;
    }

	$(function(){

	    $.ajax({
            type: "GET",
            url: "/admin/resource/findResource",
            dataType: "json",
            success: function(data){
                var arr = data.data;
                var lis = $("#menu").find("li");
				for(var i=0;i<arr.length;i++){
				    var obj = arr[i];
				    for(var j=0;j<lis.length;j++){
				        var li = lis[j];
				        if(obj.resourceName == $(li).attr("name")){
				            $(li).show();
				            var div = $(li).find("div");
                            $(obj.children).each(function(item,child){
                                $(div).append($("<li class='tt'><a href='javascript:void(0)' opt='"+JSON.stringify(child)+"'>"+child.resourceName+"</a></li>"));
                            });
                            continue;
						}
					}
				}



                $('.tt').on('click','a',function(e,b){
                    // var obj = JSON.parse($(this).attr("opt"));
                    // var ul = document.getElementById("deviceulid")//定位ul
                    //
                    // var li= document.createElement("li"); //创建li
                    // var href_a = document.createElement("a"); //创建li中的链接a
                    // href_a.href="/js/test.html"; //连接地址或执行函数
                    // href_a.innerHTML =obj.resourceName; //链接显示文本（相当于标签标题）
                    // //li.innerHTML=""; //标签页的标题
                    // li.id=obj.id; //标签页ID
                    //
                    // li.appendChild(href_a);//将a添加到li
                    // ul.appendChild(li); //将li添加到ul
                    options = JSON.parse($(this).attr("opt"))
                    var exists = checkTabIsExists("deviceulid", options.reousrceName);
                    if(exists){
                        $("#tab_a_"+options.reousrceName).click();
                    } else {
                        $("#deviceulid").append('<li id="tab_li_'+options.reousrceName+'"><a href="#tab_content_'+options.reousrceName+'" data-toggle="tab" id="tab_a_'+options.reousrceName+'"><button class="close closeTab" type="button" onclick="closeTab(this);">×</button>'+options.reousrceName+'</a></li>');

                        //固定TAB中IFRAME高度
                        mainHeight = $(document.body).height() - 5;

                        var content = '';
                        if(options.content){
                            content = option.content;
                        } else {
                            content = '<iframe src="' + options.resourceUrl + '" width="100%" height="'+mainHeight+'px" frameborder="no" border="0" marginwidth="0" marginheight="0" scrolling="yes" allowtransparency="yes"></iframe>';
                        }
                        $("#"+options.reousrceName).append('<div id="tab_content_'+options.reousrceName+'" role="tabpanel" class="tab-pane" id="'+options.reousrceName+'">'+content+'</div>');
                        $("#tab_a_"+options.reousrceName).click();
                    }

                });



			}
		})
	})

</script>
<canvas id="myCanvas" width="" height=""></canvas>

<div class="page-wrapper toggled">
	<nav id="sidebar" class="sidebar-wrapper">
		<div class="sidebar-content">
			<a href="#" id="toggle-sidebar"><i class="fa fa-bars"></i></a>
			<div class="sidebar-brand">
				<a href="#">pro sidebar</a>
			</div>
			<div class="sidebar-header">
				<div class="user-pic">
					<img class="img-responsive img-rounded" src="assets/img/user.jpg" alt="">
				</div>
				<div class="user-info">
					<span class="user-name">Jhon <strong>Smith</strong></span>
					<span class="user-role">Administrator</span>
					<div class="user-status">
						<a href="#"><span class="label label-success">Online</span></a>
					</div>
				</div>
			</div><!-- sidebar-header  -->
			<div class="sidebar-search">
				<div>
					<div class="input-group">
						<input type="text" class="form-control search-menu" placeholder="Search for...">
						<span class="input-group-addon"><i class="fa fa-search"></i></span>
					</div>
				</div>
			</div><!-- sidebar-search  -->
			<div class="sidebar-menu" >
				<ul id="menu">
					<li class="sidebar-dropdown" name="test" hidden="hidden">
						<a href="#"><i class="fa fa-tv"></i><span>Menu 1</span><span class="label label-danger">New</span></a>
						<div class="sidebar-submenu">
							<ul>
								<li><a href="#">submenu 1 <span class="label label-success">10</span></a> </li>
								<li><a href="#">submenu 2</a></li>
								<li><a href="#">submenu 3</a></li>
								<li><a href="#">submenu 4</a></li>
							</ul>
						</div>
					</li>
					<li class="sidebar-dropdown" name="系统管理" hidden="hidden">
						<a  href="#" ><i class="fa fa-tv"></i><span>系统管理</span></a>
						<div class="sidebar-submenu">
						</div>
					</li>
				</ul>
			</div><!-- sidebar-menu  -->
		</div><!-- sidebar-content  -->

		<div class="sidebar-footer">
			<a href="#"><i class="fa fa-bell"></i><span class="label label-warning notification">3</span></a>
			<a href="#"><i class="fa fa-envelope"></i><span class="label label-success notification">7</span></a>
			<a href="#"><i class="fa fa-gear"></i></a>
			<a href="/logout"><i class="fa fa-power-off"></i></a>
		</div>
	</nav><!-- sidebar-wrapper  -->
	<main class="page-content">
		<div class="container-fluid">

			<!--<header class="header">
				<h1>点击左上角的 <i class="fa fa-bars"></i> 按钮来查看侧边栏效果</h1>
			</header>-->
			<ul class="nav nav-tabs" id="deviceulid">
			</ul>

		</div>


	</main><!-- page-content" -->
</div><!-- page-wrapper -->


<script src="js/bootstrap/bootstrap.min.js" type="text/javascript"></script>

<script src="assets/js/jquery.mCustomScrollbar.concat.min.js"></script>
<script src="assets/js/custom.js"></script>
<script src="js/xuehua.js"></script>
</body>
</html>